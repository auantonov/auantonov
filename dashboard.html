<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="assets/img/logo-fav.png">
    <title>Beagle</title>

<link href="css/bootstrap.min.css" rel="stylesheet">
	
	
  </head>
  <body>
    <div class="be-wrapper be-nosidebar-left">
      <div class="be-content">
		
        <div class="main-content container-fluid">
          <div class="row">
            <div class="col-xs-12 col-md-8 col-md-offset-2">
               <div class="panel panel-default panel-table">
					<div class="panel-heading">Паи которыми вы владеете (<span id='myeth'>loading</span>)
					  <div class="tools"><span class="icon mdi mdi-download"></span><span class="icon mdi mdi-more-vert"></span></div>
					</div>
					<div class="panel-body">
					  <table class="table table-striped table-borderless">
						<thead>
						  <tr>
							<th >Токен</th>
							<th class="number">Ваша доля</th>
							<th class="number">Текущая цена за ед.</th>
							<th class="number">Результат</th>
							<th class="number">Выпуск</th>
							<th class="">Тип</th>
							<th class="actions">Действие</th>
						  </tr>
						</thead>
						<tbody class="no-border-x">
						<tr class='pie' data-price='49000' data-ticker='TST' rel='0x8a70cf25cf32e728be9e30c20b2781f60cb0ed6d'>
							<td>TST тестовый</td>
							<td class="number mytokenbalance" >
							loading
							</td>
							<td class="number"><span>100р</span></td>
							<td class="number">+33%</td>
							<td class="number">23.10.2019</td>
							<td>Аргесивный</td>
							<td class="action"><a href="#" class="icon"><i class="mdi mdi-plus"></i>Открыть</a></td>
						  </tr>
						 
						</tbody>
					  </table>
					</div>
				  </div>
           
            </div>
          </div>

		  <div class="row" style='display:none' id='centru'>
            <div class="col-xs-12 col-md-8 col-md-offset-2">
               <div class="panel panel-default panel-table">
				   <div class="panel-heading">Действия
					  <div class="tools"><span class="icon mdi mdi-download"></span><span class="icon mdi mdi-more-vert"></span></div>
					</div>
					<div class="panel-body">
					    <div class="tab-container">
						  <ul class="nav nav-tabs">
							<li class="active"><a href="#news" data-toggle="tab">Обзор</a></li>
							<li ><a href="#buy2" data-toggle="tab">Купить</a></li>
							<li><a href="#sell" data-toggle="tab">Продать</a></li>
							<li><a href="#send" data-toggle="tab">Перевести</a></li>
						  </ul>
						  <div class="tab-content">
							<div id="news" class="tab-pane active cont">
							  <h4>Новости</h4>
							  <p> Все отлично, идем ровно, купили компанию.</p>
							</div>
							<div id="buy2" class="tab-pane">
							<p><br>
								Хочу купить <input type='number' name='' onkeyup='recalc_buy()' id='kupit' value='1000'> паев проекта <span id='pr'>??</span>,  это примерно ~<span id='inrub'></span>р, для покупки переведите <span id='inbtc'>1</span> 
								BTC на адрес 14oegN5FBq335sy2GPyFnD84r4QLRGNhNQ 
							</p>
							</div>
							<div id="sell" class="tab-pane">
							  <p>Consectetur adipisicing elit. Ipsam ut praesentium, voluptate quidem necessitatibus quam nam officia soluta aperiam, recusandae.</p>
							  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quos facilis laboriosam, vitae ipsum tenetur atque vel repellendus culpa reiciendis velit quas, unde soluta quidem voluptas ipsam, rerum fuga placeat rem error voluptate eligendi modi. Delectus, iure sit impedit? Facere provident expedita itaque, magni, quas assumenda numquam eum! Sequi deserunt, rerum.</p><a href="#">Read more  </a>
							</div>
							<div id="send" class="tab-pane">
								Получатель <input type='text' name='' placeholder='0x920ef9458B0023f64E16495956F9b9072b0c28d3' id='poluchatel'>
								количество <input type='number' name='' class='' value='1000'> 
								<input type='button' name='' onclick='send_token();' class='btn' value='Перевести'>
								<script>
								
								function send_token(){
									var options = options || {};
									var to = $("#poluchatel").val();
									bundle.utility.getNextNonce(web3, myeth, function(err, nextNonce){
										options.nonce = nextNonce;
										options.to = curaddr;
										options.data = '0xa9059cbb000000000000000000000000'+$("#poluchatel").val().replace('0x','')+'00000000000000000000000000000000'+pad("5dc",32); //вставить перевод некой суммы 
										console.log(options.data);
										var tx = new Tx(options);
										signTx(web3, myeth, tx, localStorage.getItem('myprivate'), function(err, tx){
											var serializedTx = tx.serialize().toString('hex');
											  var url = 'https://'+(config.ethTestnet ? 'testnet' : 'api')+'.etherscan.io/api';
											  var formData = {module: 'proxy', action: 'eth_sendRawTransaction', hex: serializedTx};
											  if (config.etherscanAPIKey) formData.apikey = config.etherscanAPIKey;
											  postURL(url, formData, function(err, body){
												if (!err) {
												  try {
													var result = JSON.parse(body);
													if (result['result']) {
													  callback(undefined, {txHash: result['result'], nonce: nonce+1});
													} else if (result['error']) {
													  callback(result['error']['message'], {txHash: undefined, nonce: nonce});
													}
												  } catch (err) {
													callback(err, {txHash: undefined, nonce: nonce});
												  }
												} else {
												  callback(err, {txHash: undefined, nonce: nonce});
												}
											  });
										});
									});
								}
								</script>
							</div>
						  </div>
						</div>
					
					</div>
				  </div>
           
            </div>
          </div>
		  
		  
		  
        </div>
      </div>
    
	</div>
	
	 <link rel="stylesheet" type="text/css" href="css/alertify.min.css"/> 
	
		<script>
	var myeth;
	var cur,price;
	function bundle_loaded() {
		
		if (typeof bundle != "undefined" && typeof bundle.Main != "undefined" && typeof bundle.Main.createAccount != "undefined") { 
			myeth = localStorage.getItem('myethaddress'); 
			if (!myeth) { 
				console.log("!myeth");
				var reg = bundle.Main.createAccount(); // return {address: address, privateKey: privateKey};
				console.log(reg);
				console.log("!lol");
				localStorage.setItem("myethaddress",reg.address);
				localStorage.setItem("myprivate",reg.privateKey);	
				myeth = reg.address;
			} 
			$("#myeth").html(myeth);
			
			$('tr.pie').each(function (index, value) { 
			  var me = $(this);
			  var url = "https://api.etherscan.io/api?module=proxy&data=0x70a08231000000000000000000000000"+myeth.replace('0x','')+"&to="+$(this).attr('rel')+"&action=eth_call";
			  console.log(url);
			  
			  $.getJSON(url,function(d){	
					$(me).find(".mytokenbalance").html(parseInt(d.result, 16));
				});
			
			});
			
			$("tr.pie").on("click",function(){
				
				$("#centru").show();
				
				cur = $(this).attr('data-ticker');
				curaddr = $(this).attr('rel');
				price = $(this).attr('data-price'); //сколько токенов получаем за 1 биткоин
				
				$("#kupit").val(); //сколько он хочет купить
				
				recalc_buy();
				
			});
			
			
			//
			/*
			$url = 'https://api.etherscan.io/api?module=proxy&data=0x70a08231000000000000000000000000'.$adres.'&to='.$contr.'&apikey=BJY6AGT4AR8WHE8DRJV3Q549UU16GIMUKB&action=eth_call';
			//echo $url;
			$mytok = json_decode(send_post($url));
			$tok = hexdec($mytok->result);
			*/
			
		} else {
			
			setTimeout(bundle_loaded,3000);
		}
		
	}
	
	function recalc_buy() {
			
				$("#kupit").val(); //сколько он хочет купить
				$("#pr").html(cur); //тикер проекта
				$("#inrub").html(); //в рублях 
				$("#inbtc").html($("#kupit").val()/price); //в битках
				 var tx = new Tx(options);
			}
	
	function pad(num, size) {
		var s = num+"";
		while (s.length < size) s = "0" + s;
		return s;
	}
	//function 
	</script>
	
	<script src="js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="js/jquery.translate.js" type="text/javascript"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/alertify.min.js" type="text/javascript"></script>
    <script src="js/ejs_production.js" type="text/javascript"></script>
    
    <script src="js/translations.js" type="text/javascript"></script>
    <script src="js/bundle.js" type="text/javascript"></script>
    <script src="js/bundle.js" type="application/javascript;version=1.7"></script>
    
	
    <script src="assets/lib/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
    <script src="assets/js/main.js" type="text/javascript"></script>
    <script src="assets/lib/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="assets/lib/prettify/prettify.js" type="text/javascript"></script>

	

	
  </body>
</html>